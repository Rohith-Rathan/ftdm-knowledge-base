# üéØ STAGE 1: MERMAID GENERATION PROMPT

## **üõ°Ô∏è ANTI-HALLUCINATION SAFEGUARDS**

### **STAGE BOUNDARY ENFORCEMENT**
- **This is Stage 1 of 7 total stages**
- **Valid stages**: 1, 2, 3, 4, 5, 6.1-6.13, 7
- **DO NOT create additional stages**
- **DO NOT reference stages beyond 7**

### **OUTPUT VALIDATION REQUIRED**
Before proceeding, validate:
- [ ] All technical specifications are accurate
- [ ] All Mermaid diagrams are syntactically correct
- [ ] All domain detection is accurate
- [ ] All references are valid
- [ ] Output is consistent with requirements

### **ERROR PREVENTION**
- Verify all information before generating
- Cross-reference with official documentation
- Ensure all Mermaid diagrams are valid
- Validate all domain intelligence
- Confirm all stage transitions are correct

## **INSTRUCTIONS FOR CURSOR AI**

You are a Senior Product Developer with 10+ years of experience. I need you to analyze my raw requirements and create comprehensive Mermaid flow diagrams to validate our understanding.

## **MY RAW REQUIREMENTS**
[USER_PROVIDES_RAW_REQUIREMENTS]

## **MINIMAL CLARIFYING QUESTIONS**

I only need these 3 essential questions to provide the best analysis:

### **1. DOMAIN & AI-AGENTIC CLARIFICATION**
- **What is the primary domain?** (healthcare, finance, e-commerce, education, AI-agentic, etc.)
- **Does this application require AI-agentic capabilities?** (Yes/No - conversational AI, AI automation, AI-assisted, multi-agent)

### **2. BUSINESS CONTEXT (If Not Clear from Requirements)**
- **What is the primary business goal?** (Only if not obvious from requirements)
- **Who are the target users?** (Only if not clear from requirements)

### **3. TECHNICAL STACK CONFIRMATION**

**IF technology stack is NOT specified in your raw requirements:**
**I will build this application using the below technology stack? (modify if you need any changes)**

1. **Backend**: .NET Core 8.0 + C# 12 + ASP.NET Core Web API
2. **Frontend**: Vue.js 3 + Vuex 4 + Vue Router 4 + Axios 1.6
3. **Database**: MongoDB with official .NET driver
4. **Authentication**: JWT + Azure AD
5. **Deployment**: Docker + Kubernetes + Azure App Services

**IF technology stack IS specified in your raw requirements:**
**I found the following technology stack in your requirements - please confirm:**

[EXTRACTED_TECHNOLOGY_STACK_FROM_REQUIREMENTS]

**If you have a different technology stack in mind, please specify your preferred stack.**

**That's it! I'll intelligently extract and infer all other details from your raw requirements and domain context.**

## **INTELLIGENT ANALYSIS & INFERENCE**

### **üéØ What I'll Extract from Raw Requirements:**
- **Business Goals**: From business context and user needs mentioned
- **User Personas**: From user roles and use cases described
- **User Volume**: From business model and target market mentioned
- **Business Model**: From revenue streams and user types described
- **Integration Requirements**: From external systems and data sources mentioned
- **Performance Requirements**: From user volume and business criticality
- **Compliance Requirements**: From domain-specific regulations and data types
- **Security Requirements**: From data sensitivity and user access patterns
- **Data Privacy Requirements**: From data types and user consent needs
- **Project Timeline**: From business urgency and feature complexity
- **Team Size**: From project complexity and resource constraints
- **Budget Range**: From project scope and technology choices
- **Success Criteria**: From business goals and user satisfaction metrics
- **Design Assets**: From existing systems and brand requirements
- **Device Mix**: From user behavior and business model
- **Accessibility Requirements**: From user diversity and compliance needs
- **User Experience Priority**: From business goals and user satisfaction
- **Data Sources**: From business processes and integration needs
- **Data Volume**: From user volume and business scale
- **Data Migration**: From existing systems and data transition needs
- **Future Features**: From business roadmap and user feedback
- **Scalability Requirements**: From growth projections and business model
- **Maintenance Requirements**: From business criticality and user support
- **Exit Criteria**: From business goals and success metrics

### **üéØ What I'll Infer from Domain Context:**
- **Industry Standards**: Best practices and patterns for the domain
- **Regulatory Requirements**: Compliance standards and security requirements
- **Technology Preferences**: Common technology stacks for the domain
- **Architecture Patterns**: Domain-specific architecture patterns
- **Business Logic**: Domain-specific calculations and workflows
- **UI/UX Patterns**: Domain-appropriate design patterns
- **Integration Patterns**: Common integration patterns for the domain
- **Performance Patterns**: Typical performance requirements for the domain
- **Security Patterns**: Domain-specific security and compliance patterns
- **Data Patterns**: Domain-specific data models and storage patterns
- **AI-Agentic Patterns**: Domain-specific AI capabilities and patterns

### **üéØ What I'll Infer from AI-Agentic Context:**
- **AI Service Integration**: Appropriate AI services for the domain
- **AI Architecture Patterns**: AI-agentic architecture patterns
- **AI Business Logic**: AI-agentic business logic and workflows
- **AI UI/UX Patterns**: AI-agentic user interface patterns
- **AI Performance Requirements**: AI-specific performance considerations
- **AI Security Requirements**: AI-specific security and compliance
- **AI Data Requirements**: AI-specific data and model requirements
- **AI Integration Patterns**: AI service integration patterns
- **AI Scalability Patterns**: AI-specific scalability considerations
- **AI Maintenance Patterns**: AI-specific maintenance and monitoring

## **WHY THESE QUESTIONS MATTER**

### **üéØ Impact on Analysis Quality:**
- **Domain & AI-Agentic**: Determines whether to apply AI-agentic patterns or focus on traditional domain patterns
- **Business Context**: Shapes user personas, workflows, and success metrics
- **Technical Context**: Influences architecture decisions, technology stack, and performance requirements
- **Compliance & Security**: Determines security patterns, audit trails, and regulatory compliance
- **Project Scope**: Affects timeline, resource allocation, and implementation approach
- **Design & UX**: Influences UI/UX patterns, accessibility, and user experience design
- **Integration & Data**: Shapes data architecture, API design, and integration patterns
- **Future Roadmap**: Ensures scalable architecture and future-proof design

### **üéØ Impact on Mermaid Diagrams:**
- **User Journey Flow**: Tailored to specific user personas and business workflows
- **System Architecture**: Optimized for technology stack and deployment environment
- **Business Process Flow**: Aligned with domain-specific processes and compliance requirements
- **Data Model**: Designed for data volume, integration requirements, and scalability needs
- **API Flow**: Structured for performance requirements and integration patterns
- **Gantt Chart**: Realistic timeline based on team size, budget, and project scope

### **üéØ Impact on Framework Progression:**
- **Stage 2 (FSD)**: Domain-specific functional specifications with proper business logic
- **Stage 3 (TSD)**: Technology-appropriate architecture with compliance considerations
- **Stage 4 (UI/UX)**: Design patterns matching user experience priorities and accessibility
- **Stage 5 (RTSD)**: Implementation specifications aligned with project constraints
- **Stages 6.1-6.13**: Implementation approach matching team size and timeline
- **Stage 7 (Backend)**: Architecture supporting scalability and maintenance requirements

## **YOUR TASK**

### **Step 1: Comprehensive Requirement Analysis**

#### **1.1: Domain Detection & Industry Analysis**
1. **Detect Domain**: Identify the primary domain (healthcare, finance, e-commerce, education, AI-agentic, etc.)
2. **AI-Agentic Detection**: **ONLY IF** domain is AI-agentic or requires AI capabilities, identify AI-agentic patterns (conversational AI, AI automation, AI-assisted, multi-agent)
3. **Industry Research**: Research industry standards, best practices, and regulatory requirements
4. **AI Service Research**: **ONLY IF** AI capabilities are needed, research AI service integrations (OpenAI, Anthropic, Azure AI, AWS AI)
5. **Compliance Mapping**: Identify relevant compliance requirements (HIPAA, PCI-DSS, GDPR, AI ethics)
6. **Domain Context**: Understand domain-specific terminology, workflows, and business processes
7. **AI Context**: **ONLY IF** AI capabilities are needed, understand AI-agentic workflows, conversation patterns, and automation requirements

#### **1.2: Business Context Analysis**
1. **Business Goals**: Identify primary business objectives and success metrics
2. **User Personas**: Define target users, their roles, and use cases
3. **Business Workflows**: Map complete business processes and workflows
4. **Success Criteria**: Define clear success criteria and acceptance criteria

#### **1.3: Functional Requirements Analysis**
1. **Complete Scope**: Ensure comprehensive understanding of the complete scope
2. **User Journey Mapping**: Map complete user journeys and workflows
3. **Feature Specifications**: Create detailed feature specifications with acceptance criteria
4. **Integration Requirements**: Identify all integration points and external dependencies

#### **1.4: Non-Functional Requirements Analysis**
1. **Performance Requirements**: Define performance benchmarks and scalability needs
2. **Security Requirements**: Identify security, authentication, and authorization needs
3. **Usability Requirements**: Define user experience and accessibility requirements
4. **Compliance Requirements**: Map regulatory and compliance requirements

#### **1.5: Validation & Clarification**
1. **Stakeholder Validation**: Validate understanding with domain experts
2. **Technical Feasibility**: Assess technical feasibility and resource requirements
3. **Risk Assessment**: Identify potential risks and mitigation strategies
4. **Iterative Refinement**: Help iterate until we have crystal-clear requirements

### **Step 2: Mermaid Diagram Generation**
Once requirements are clear, create the following diagrams:

#### **2.1: User Journey Flow**
**Display this diagram in your response:**
```mermaid
graph TD
    A[Start] --> B[Step 1]
    B --> C[Step 2]
    C --> D[Decision Point]
    D -->|Yes| E[Path A]
    D -->|No| F[Path B]
    E --> G[End]
    F --> G
```

#### **2.2: System Architecture Flow**
**Display this diagram in your response:**
```mermaid
graph TD
    A[Frontend] --> B[API Gateway]
    B --> C[Microservice 1]
    B --> D[Microservice 2]
    C --> E[Database 1]
    D --> F[Database 2]
    G[External Service] --> B
```

#### **2.3: Business Process Flow**
**Display this diagram in your response:**
```mermaid
graph TD
    A[Business Event] --> B[Process Step 1]
    B --> C[Decision Point]
    C -->|Condition 1| D[Process A]
    C -->|Condition 2| E[Process B]
    D --> F[End State]
    E --> F
```

#### **2.4: Data Flow Diagram**
**Display this diagram in your response:**
```mermaid
graph TD
    A[Data Source] --> B[Data Processing]
    B --> C[Data Validation]
    C --> D[Data Storage]
    D --> E[Data Retrieval]
    E --> F[Data Presentation]
```

#### **2.5: Decision Tree Flow**
**Display this diagram in your response:**
```mermaid
graph TD
    A[Root Decision] --> B{Condition 1?}
    B -->|Yes| C[Action A]
    B -->|No| D{Condition 2?}
    D -->|Yes| E[Action B]
    D -->|No| F[Action C]
```

#### **2.6: Gantt Chart**
**Display this diagram in your response:**
```mermaid
gantt
    title Project Timeline
    dateFormat  YYYY-MM-DD
    section Phase 1
    Project Setup    :a1, 2024-01-01, 7d
    Authentication   :after a1, 14d
    section Phase 2
    File Upload      :2024-01-22, 21d
    AI Processing    :2024-02-12, 28d
    section Phase 3
    Data Review      :2024-03-11, 14d
    Submission       :2024-03-25, 7d
    section Phase 4
    Testing          :2024-04-01, 14d
    Deployment       :2024-04-15, 7d
```

### **Step 3: Visual Preview & File Persistence**
**CRITICAL**: Show Mermaid diagrams in response AND save as both `.mmd` files AND image files:

1. **Display each diagram** in the response using proper Mermaid syntax for visual preview
2. **Use the enhanced script** to generate both MMD and image files automatically
3. **Verify file creation** by listing the generated files
4. **Provide file paths** for each generated diagram

#### **Required Diagram Display Format:**
For each diagram, use this exact format in your response:

```mermaid
[DIAGRAM_CONTENT_HERE]
```

**Example:**
```mermaid
graph TD
    A[User Login] --> B[Authentication]
    B --> C[Dashboard]
    C --> D[User Actions]
```

#### **Required File Generation:**
Run the complete Stage 1 workflow to generate files:
```bash
./scripts/stage1-complete-workflow.sh
```

This will automatically:
- Create `Stage1_Mermaid_Generation/diagrams/` directory structure
- Generate 6 `.mmd` files (user_journey.mmd, system_architecture.mmd, etc.)
- Generate 6 PNG image files in `diagrams/images/` directory
- Verify file creation and provide detailed status
- Generate a comprehensive report
- Handle both CLI and online image generation methods

### **Why Both MMD and Image Files?**
- **MMD files**: For technical users who can read Mermaid syntax
- **Image files**: For stakeholders, clients, and non-technical users who need visual verification
- **Easy sharing**: Image files can be easily shared via email, presentations, or documentation
- **Universal understanding**: Everyone can understand visual flow diagrams
- **Verification**: Visual confirmation that the diagrams match requirements

### **Step 4: Figma Analysis (If UXD Provided)**
**CRITICAL**: If UXD folder with Figma links is provided:

1. **Analyze Figma links** from `UXD/figma_links.md` file
2. **Run comprehensive Figma analysis** using the framework script
3. **Download assets** (icons, images, components) from Figma screens
4. **Generate CSS variables** from design system analysis
5. **Create asset inventory** with file paths and usage contexts
6. **Provide asset usage guide** for Vue.js implementation

**Figma Analysis Commands:**
```bash
# Run comprehensive Figma analysis
./scripts/comprehensive-figma-analysis.sh

# This will:
# - Analyze all Figma screens
# - Download assets to figma_assets/screens/
# - Generate CSS variables
# - Create asset inventory
# - Generate usage guide
```

**Required Files to Generate:**
- `user_journey.mmd`
- `system_architecture.mmd` 
- `business_process.mmd`
- `data_flow.mmd`
- `decision_tree.mmd`
- `gantt_chart.mmd`

### **Step 4: Interactive Refinement**
1. **Present each diagram** for your review
2. **Ask for feedback** on accuracy and completeness
3. **Refine diagrams** based on your feedback
4. **Update saved files** with refinements
5. **Iterate until perfect** representation of your vision

#### **Iterative Refinement Process:**
If user requests changes to requirements or diagrams:

**Option 1: Requirements Changes**
- User provides updated requirements
- Run: `./scripts/iterative-mermaid-refinement.sh`
- System will backup existing files and generate new ones

**Option 2: Specific Diagram Changes**
- User specifies which diagram needs changes
- Create custom modifications in `custom_diagrams.json`
- Run: `./scripts/enhanced-iterative-mermaid-generator.py --custom-diagrams custom_diagrams.json`

**Option 3: Complete Regeneration**
- User provides completely new requirements
- System replaces all files with new versions
- Maintains backup of previous versions

#### **Refinement Commands:**
```bash
# For requirement changes
./scripts/iterative-mermaid-refinement.sh

# For custom diagram modifications
python3 scripts/enhanced-iterative-mermaid-generator.py --requirements "new requirements" --custom-diagrams custom_diagrams.json

# For complete regeneration
python3 scripts/enhanced-iterative-mermaid-generator.py --requirements "updated requirements"
```

### **Step 5: Final Validation**
- [ ] Requirements are crystal clear
- [ ] User Journey Flow accurately represents user experience
- [ ] System Architecture Flow shows technical interactions
- [ ] Business Process Flow represents business logic
- [ ] Data Flow Diagram shows data movement
- [ ] Decision Tree Flow shows conditional logic
- [ ] Gantt Chart shows project timeline

## **CLARIFYING QUESTIONS I SHOULD ASK**

### **Target Users**
- Who are your primary users?
- What age group and technical skill level?
- What are their main goals and pain points?

### **Core Features**
- What are the must-have features vs nice-to-have?
- What are the core user workflows?
- What are the business rules and constraints?

### **Technical Requirements**
- What platforms do you need? (Web, Mobile, Desktop)
- What are your performance requirements?
- What integrations do you need?

### **Business Context**
- What is your business model?
- What are your success metrics?
- What is your timeline and budget?

### **Success Criteria**
- How will you measure success?
- What are your key performance indicators?
- What are your acceptance criteria?

## **EXPECTED OUTPUT**

After refinement, you will have:
- ‚úÖ **Crystal clear requirements** with no ambiguities
- ‚úÖ **Complete set of Mermaid diagrams** (6 diagrams + 6 MMD files + 6 image files)
- ‚úÖ **Visual validation** of your understanding
- ‚úÖ **Ready for Stage 2** (FSD Creation)

## **QUALITY GATES & VALIDATION**

### **Requirements Gate (MANDATORY)**
Before proceeding to Stage 2, ensure:
- [ ] **Domain Detection**: Primary domain identified and validated
- [ ] **Industry Research**: Industry standards and best practices researched
- [ ] **Compliance Mapping**: Regulatory requirements identified and documented
- [ ] **Complete Scope**: Comprehensive understanding of complete scope
- [ ] **User Journey Mapping**: Complete user journeys and workflows mapped
- [ ] **Feature Specifications**: Detailed feature specifications with acceptance criteria
- [ ] **Success Criteria**: Clear success criteria and acceptance criteria defined
- [ ] **Stakeholder Validation**: Understanding validated with domain experts
- [ ] **Technical Feasibility**: Technical feasibility assessed
- [ ] **Risk Assessment**: Potential risks identified and mitigation strategies planned

### **Quality Assurance Checklist**
- [ ] All requirements are clear and unambiguous
- [ ] All user journeys are mapped
- [ ] All system components are identified
- [ ] All business processes are documented
- [ ] All diagrams are accurate and complete
- [ ] Domain-specific patterns and standards identified
- [ ] Compliance requirements documented
- [ ] Performance and security requirements defined

## **STAGE 1 COMPLETION SUMMARY**

### **‚úÖ What Stage 1 Accomplished:**
- **Domain Detection**: Identified primary domain and AI-agentic requirements
- **Requirements Refinement**: Transformed raw requirements into crystal clear specifications
- **Mermaid Diagrams**: Generated 6 comprehensive flow diagrams (User Journey, System Architecture, Business Process, Data Model, API Flow, Gantt Chart)
- **Visual Files**: Created both MMD files and image files for universal understanding
- **Quality Gates**: Passed all validation checkpoints

### **üìã Generated Outputs:**
- **Refined Requirements Document**: Crystal clear requirements with no ambiguities
- **6 Mermaid Diagrams**: Complete visual representation of your system
- **6 MMD Files**: Technical format for developers
- **6 Image Files**: Visual format for stakeholders and clients
- **Domain Intelligence**: Applied throughout the analysis process

### **üîç Please Review:**
1. **Review the refined requirements** - Do they accurately capture your vision?
2. **Review all 6 Mermaid diagrams** - Do they represent your system correctly?
3. **Check the image files** - Are the visual flows clear and accurate?
4. **Validate the domain detection** - Is the primary domain correctly identified?

### **‚û°Ô∏è Next Steps:**
**Shall I proceed to Stage 2: FSD Creation?**

*Stage 2 will use your refined requirements and Mermaid diagrams to create a comprehensive Functional Specification Document.*

---

**Ready to begin?** Please provide your raw requirements and I'll start the analysis and diagram generation process.
